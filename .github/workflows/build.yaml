name: AKB K50 å†…æ ¸æ„å»º
on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout
        uses: actions/checkout@master

      - name: Install deps
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential \
            libssl-dev \
            flex \
            bison \
            libfl-dev \
            bc \
            xsltproc \
            libxml2-utils \
            device-tree-compiler \
            make \
            python3 \
            ccache \
            git \
            libarchive-tools \
            tar \
            gzip \
            bzip2 \
            unzip \
            wget \
            zlib1g-dev \
            automake \
            pkg-config \
            libgmp-dev \
            libmpc-dev \
            libmpfr-dev \
            libncurses-dev

      - name: Prepare
        run: |
          chmod +x build_script.sh
          (. ./build_script.sh ;prepare)

      # ğŸ‘‡ æ–°å¢ï¼šç³»ç»Ÿä¿¡æ¯è¾“å‡ºï¼ˆç®€æ´ç¾è§‚ï¼‰
      - name: System Info
        run: |
          echo "ğŸ–¥ï¸  **System Configuration**"
          echo "----------------------------"
          echo "CPU   : $(nproc) cores ($(lscpu | grep 'Model name' | awk -F': ' '{gsub(/^[ \t]+|[ \t]+$/, \"\", $2); print $2}' | cut -c1-40))"
          echo "Memory: $(free -h | awk '/^Mem:/ {print $2}') RAM (Free: $(free -h | awk '/^Mem:/ {print $7}'))"
          echo "Disk  : $(df -h / | awk 'NR==2 {print $2, \"used out of\", $4, \"(\"$5\" used)\"}')"
          echo "OS    : $(grep PRETTY_NAME /etc/os-release | cut -d\"=\" -f2 | tr -d '\"')"

      - name: Build
        run: |
          (. ./build_script.sh ;main)

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: "output"
          path: out/*